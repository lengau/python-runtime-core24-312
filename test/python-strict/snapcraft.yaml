name: test-python-strict
base: core24 # the base snap is the execution environment for this snap
version: '0.1' # just for humans, typically '1.2+git' or '1.3.2'
summary: Test a simple Python script with strict confinement.
description: Test a simple Python script with strict confinement.

grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict

environment:
  PATH: $SNAP/py/usr/bin:$PATH

plugs:
  python-runtime:
    content: python-runtime
    interface: content
    target: "$SNAP/python-runtime"


parts:
  setup-tests:
    plugin: nil
    override-build: |
      # Install the Python runtime snap for our development environment
      if [ -f /root/project/python-runtime-*.snap ]; then
        snap install --dangerous /root/project/python-runtime-*.snap
      elif snap list python-runtime-core24-312; then
        snap refresh --amend python-runtime-core24-312
      else
        snap install --edge python-runtime-core24-312
      fi
  script:
    after: [setup-tests]
    plugin: nil
    override-build: |
      echo "print('Hello from a Python script')" > "${CRAFT_PART_INSTALL}/hello.py"
  mypy:
    after: [setup-tests]
    plugin: python
    source: .
    python-packages:
      - mypy==1.18.2

apps:
  script:
    command: bin/python $SNAP/hello.py
  mypy:
    command: bin/python -m mypy
    plugs:
      - home
